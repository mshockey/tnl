window.WPEM=window.WPEM||{},jQuery(document).ready(function(e){function t(t,a){e.ajax({type:"GET",url:"//api.wordpress.org/themes/info/1.1/",dataType:"jsonp",data:{action:"theme_information",request:{slug:a}},success:function(e){wpem_theme_vars.themes[t]=e,n(e,t)}})}function n(t,n){var i=e("#wpem-template-theme"),o=e(".theme-browser .themes"),r="undefined"!=typeof t.slug?t.slug:"",l="undefined"!=typeof t.name?t.name:"",m="undefined"!=typeof t.author?t.author:"",c="undefined"!=typeof t.screenshot_url?t.screenshot_url:"",d=e(e.trim(i.clone().html()));e(d).appendTo(o),d.addClass(r),d.attr("data-theme",r),c?d.find(".theme-screenshot img").attr("src",c):(d.find(".theme-screenshot").addClass("blank"),d.find(".theme-screenshot img").remove()),d.find(".theme-author span").text(m),d.find(".theme-name").text(l),d.on("click",".theme-actions a",function(t){t.preventDefault();var n=e(this).closest(".theme");return a(n),!1}),d.on("click",function(){s(t,n)})}function a(t){e("#wpem_selected_theme").val(t.data("theme")),t.removeClass("hover").addClass("active");var n=e(".wpem-screen");n.find("form").submit()}function s(t,n){var r=e("#wpem-template-theme-preview"),l=e(".wrap"),m=e("#wpem-template-header-images"),c=e(e.trim(r.clone().html())),d=c.find("#wpem-header-images-wrapper"),h="undefined"!=typeof t.slug?t.slug:"",p="undefined"!=typeof t.name?t.name:"",u="undefined"!=typeof t.author?t.author:"",f="undefined"!=typeof t.version?t.version:"",v=wpem_theme_vars.preview_url+"&theme="+t.slug,g="undefined"!=typeof t.screenshot_url?t.screenshot_url:"";"undefined"!=typeof t.sections.description?t.sections.description:"";d.html(m.html());var w=d.find("li.selected a").data("image-url"),_=e("#wpem_selected_header_image_url");"undefined"!=typeof w&&(v+="&header_image="+encodeURIComponent(w),_.val(w)),e(c).appendTo(l).show(),c.find(".theme-name").text(p),c.find(".theme-by span").text(u),c.find(".theme-screenshot").attr("src",g),c.find(".theme-version span").text(f),$description=d.is(":empty")?t.sections.description:o(t.sections.description,140,"&nbsp;&hellip;"),c.find(".theme-description").html($description),i();var y=c.find(".wp-full-overlay-main");y.append("<iframe>"),y.find("iframe").attr("src",v),c.on("click","a.previous-theme",function(e){e.preventDefault(),n=0===n?wpem_theme_vars.themes.length-1:n-1;var t=wpem_theme_vars.themes[n];c.remove(),s(t,n)}),c.on("click","a.next-theme",function(e){e.preventDefault(),n=wpem_theme_vars.themes.length-1===n?0:n+1,c.remove();var t=wpem_theme_vars.themes[n];s(t,n)}),c.on("click","a.theme-install",function(t){t.preventDefault();var n=e(".theme."+h);c.find("a.close-full-overlay").click(),a(n)}),c.on("click","a.close-full-overlay",function(e){e.preventDefault(),c.remove()}),c.on("click",".wpem-header-images-list li a",function(t){t.preventDefault();var n=e(this),a=n.parent(),s=n.data("image-url"),i="",o=e(".wp-full-overlay-main iframe");!a.hasClass("selected")&&a.siblings(".selected").length>0&&(i=a.siblings(".selected").find("a").data("image-url"),a.siblings().removeClass("selected")),a.toggleClass("selected"),m.html(d.html());var r=decodeURIComponent(o.attr("src"));a.hasClass("selected")?r=""===i?r+"&header_image="+s:r.replace(i,s):(r=r.replace("&header_image="+s,""),s=""),_.val(s),o.on("load",function(){o.css("opacity",1),o.off("load")}),o.css("opacity",0),o.attr("src",r)}),e("button.collapse-sidebar").on("click",function(){return"true"===e(this).attr("aria-expanded")?(WPEM.Pointers.hideAll(),e(this).attr({"aria-expanded":"false","aria-label":wpem_theme_vars.i18n.expand})):(setTimeout(function(){i()},200),e(this).attr({"aria-expanded":"true","aria-label":wpem_theme_vars.i18n.collapse})),e(this).toggleClass("collapsed").toggleClass("expanded"),e(".wp-full-overlay").toggleClass("collapsed").toggleClass("expanded"),!1})}function i(){window.WPEM.Pointers.openFirstInRange("wpem_theme_preview_",[1,2,3])}function o(e,t,n){if(e.length<=t)return e;for(var a=e.split(" "),s=a[0].length,i=1;i<a.length&&!(s===t||s+a[i].length+1>t);i++)s+=a[i].length+1;return a.slice(0,i).join(" ")+(n||"")}e(document).on("mouseenter",".theme",function(){e(".theme").removeClass("hover")}),e(document).on("keyup",function(t){9===t.keyCode&&(e(".theme").removeClass("hover"),e("a.preview-theme:focus").closest(".theme").addClass("hover"))}),e(document).on("keydown",function(t){switch(t.keyCode){case 27:e("a.close-full-overlay").click();break;case 37:e("a.previous-theme").click();break;case 39:e("a.next-theme").click()}}),e.each(wpem_theme_vars.themes,function(e,n){t(e,n)})});
